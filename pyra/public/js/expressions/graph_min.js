var bandwidth_line_width=15;var roundTo=5;var y_axis_adjustment=7;var splitAttribute="|";var max_y_axis=null;var minXaxis=-0.5;var floorValue=-999999999;var minStartingValue=100000000000;var maxStartingValue=-100000000000;var angle_horizontal=0;var angle_diagonal=-Math.PI/6;var angle_vertical=-Math.PI/2;var angle_logo=Math.PI/2;function draw_logo(f){var c=f.plot.getCanvas();var b=c.getContext("2d");var e=new Image();var d=355;if(f.header=="grandiose"){var a=new Image();a.onload=function(){b.save();var g=Math.PI/2;b.rotate(g);b.fillStyle="#000000";b.fillRect(430,-c.width+min_border_margin-60,272,54);b.drawImage(a,430,-c.width+min_border_margin-60);b.restore()};a.src="/images/grandiose/Project_Grandiose.gif";d=200}e.onload=function(){b.save();var g=Math.PI/2;b.rotate(g);this_width=$("canvas.flot-overlay").css("width").replace("px","");set_x_axis_for_logo=-this_width+min_border_margin-40;b.drawImage(e,d,set_x_axis_for_logo);b.restore()};e.src="/img/logo.gif"}function draw_legend_on_canvas(k){kinetic_width=1800;kinetic_height=800;var d="kinetic_legend";var e=new Kinetic.Layer();var f=new Kinetic.Text({x:20,y:20,text:"Legend",fontSize:36,align:"center",fontFamily:"sans-serif",fill:"black"});e.add(f);var g=new Object();g.offset_y=35;g.start_y=70;g.this_y=g.start_y;g.this_x=25;g.height_of_square=11;g.width_of_square=15;g.txt_y_offset=1;var a=k.sample_type_display_order;var i=k.plot;var n=k.plot_data;number_of_legends=0;if(k.graph_type=="scatter"){for(var b in k.plot_data){colour=k.probe_color_dict[b]["color"];raw_probe=b;display_probe_id=k.probe_color_dict[b]["display_probe_id"]+" "+raw_probe;url="";txt_colour="black";var c=k.probe_information[b];if(c>1){txt_colour="red";display_probe_id=display_probe_id+"*";chip_type=k.chip_type;db_id=k.db_id;url="/probes/multi_map_summary?probe_id="+encodeURIComponent(raw_probe)+"&chip_type="+chip_type+"&db_id="+db_id}mouse_over=b;draw_individual_legends(e,g,display_probe_id,colour,txt_colour,url,k,mouse_over);number_of_legends++}}else{if(k.graph_type=="line"){a=[]}var l={};for(var m in n){if(m.indexOf("|")!=-1){original_sample_type=m;temp_sample_type=m.split("|");m=temp_sample_type[1];colour=n[original_sample_type].color}else{colour=n[m].color}if(k.graph_type=="line"){j=jQuery.inArray(m,a);if(j==-1){a.push(m);a.sort()}}l[m]=colour}for(var j in a){m=a[j];colour=l[m];url="";txt_colour="black";mouse_over="";e=draw_individual_legends(e,g,m,colour,txt_colour,url,k,mouse_over);number_of_legends++}}number_of_legend_columns=Math.ceil(number_of_legends/20);width=300;if(number_of_legend_columns>1){width=30+(number_of_legend_columns)*200;height=800}else{height=(number_of_legends*35)+100}$("#kinetic_legend").css("width",width+"px").css("height",height+"px");var h=new Kinetic.Stage({container:d,width:width,height:height});h.add(e)}function draw_individual_legends(f,h,b,a,d,c,j,g){if(h.this_y>740){h.this_y=h.start_y;h.this_x=h.this_x+200}var i=new Kinetic.Rect({x:h.this_x-2,y:h.this_y-2,width:h.width_of_square+4,height:h.width_of_square+4,fill:"white",stroke:"black",strokeWidth:1});f.add(i);var i=new Kinetic.Rect({x:h.this_x,y:h.this_y,width:h.width_of_square,height:h.width_of_square,fill:a,stroke:"black",strokeWidth:1});f.add(i);var e=new Kinetic.Text({x:h.this_x+20,y:h.this_y+h.txt_y_offset,text:b,fontSize:12,align:"left",width:180,fontFamily:"sans-serif",fill:d});if(j.graph_type=="scatter"&&j.ref_type!="miRNA"){e.setName(g);e.on("mouseover",function(k){display_name_full=k.targetNode.attrs.text;$("#generic_tooltip").hide().html(display_name_full).css("top",k.pageY).css("left",k.pageX+30).show()});e.on("mouseout",function(k){$("#generic_tooltip").hide()})}if(c!=""){e.url=c;e.on("click",function(){window.location=this.url})}f.add(e);h.this_y=h.this_y+h.offset_y;return f}function draw_xaxis_labels(n){xaxis_labels=n.xaxis_labels;var e=n.plot.getPlotOffset();var l=n.plot.getAxes();if(n.click_to_select_probes==undefined){n.click_to_select_probes=false}kinetic_width=1170;if(n.expand_horizontally){kinetic_width=n.expand_horizontally_width}var f="xaxis_labels"+n.ds_id;var k=new Kinetic.Stage({container:f,width:kinetic_width,height:220});var j=new Kinetic.Layer();for(var g in xaxis_labels){var b=xaxis_labels[g]["level"];var o=xaxis_labels[g]["xaxis_position"];var c=xaxis_labels[g]["id"];var a=xaxis_labels[g]["name"];var d=n.probe_information[c];var m=xaxis_labels[g]["type"];txt=new Object();multi_map=false;txt.fill_style="black";raw_probe=c;if(d>1&&n.click_to_select_probes==false){txt.fill_style="red";a=a+"*";multi_map=true}txt.angle=angle_diagonal;txt.plot=n.plot;if(large){if(b==1){txt.abs_y=2155}if(b==2){txt.abs_y=2500}}else{if(b==1){txt.abs_y=735;kinetic_y=101}if(b==2){txt.abs_y=790;kinetic_y=195}}txt.x=o+0.2;txt.text_align="right";txt.font="12px sans-serif";var l=txt.plot.getAxes();if(m=="Probe"&&n.ref_type!="miRNA"){txt.text=a+" "+c}else{txt.text=a}length_of_name=txt.text.length;if(length_of_name>=20){half_length_of_name=length_of_name/2;name1=txt.text.slice(0,half_length_of_name);name2=txt.text.slice(half_length_of_name);txt.text=name1;draw_text_on_canvas(txt);txt.text=name2;txt.abs_y=txt.abs_y+15;draw_text_on_canvas(txt)}else{draw_text_on_canvas(txt)}kinetic_x=l.xaxis.p2c(txt.x)+e.left-178;var h=new Kinetic.Text({x:kinetic_x,y:kinetic_y,text:a,fontSize:13,align:"right",rotationDeg:330,fontFamily:"sans-serif",width:200,fullText:txt.text,fill:txt.fill_style});if(m=="Probe"&&n.ref_type!="miRNA"){h.setName(c);h.on("mouseover",function(i){display_name_full=i.targetNode.attrs.text+" "+i.targetNode.attrs.name;$("#generic_tooltip").hide().html(display_name_full).css("top",i.pageY).css("left",i.pageX+30).show()});h.on("mouseout",function(i){$("#generic_tooltip").hide()})}if(multi_map){h.raw_probe=raw_probe;h.chip_type=n.chip_type;h.db_id=n.db_id;h.on("click",function(){window.location="/probes/multi_map_summary?probe_id="+encodeURIComponent(this.raw_probe)+"&chip_type="+this.chip_type+"&db_id="+this.db_id})}if(n.click_to_select_probes){h.raw_probe=raw_probe;h.on("click",function(){var p=$("div.select_probes textarea");var i=p.val();if(i==""){p.val(this.raw_probe)}else{p.val(i+" "+this.raw_probe)}})}j.add(h)}k.add(j)}function set_markings_to_array(b){markings=[];for(var a in b.markings){markings[a]=b.markings[a]}return markings}function is_array(a){return typeof(a)=="object"&&(a instanceof Array)}function roundNumber(b,c){var a=Math.round(b*Math.pow(10,c))/Math.pow(10,c);return a}function drawGraph(a){graph_id=a.graph_id;a.plot=$.plot($(graph_id),a.flot_data,a.options);draw_xaxis_labels(a);draw_yaxis_labels(a);draw_title(a);draw_detection_threshold_and_median(a);draw_legend_on_canvas(a);draw_logo(a);return a}function draw_detection_threshold_and_median(e){var a=txt.plot.getCanvas().getContext("2d");var d=txt.plot.getPlotOffset();var c=txt.plot.getAxes();var b=20;detection_threshold=e.detection_threshold;if(detection_threshold!=undefined&&detection_threshold!=0&&detection_threshold!="NULL"){txt=new Object();txt.text="DT ("+detection_threshold+")";txt.angle=angle_horizontal;txt.plot=e.plot;txt.abs_y=c.yaxis.p2c(detection_threshold)+d.top+b;txt.x=e.min_x_axis;txt.width=200;txt.text_align="left";txt.fill_style="#000";draw_text_on_canvas(txt)}median_dataset_expression=e.median_dataset_expression;if(median_dataset_expression!=undefined&&median_dataset_expression!=0&&median_dataset_expression!="NULL"){txt=new Object();txt.text="Med ("+median_dataset_expression+")";txt.angle=angle_horizontal;txt.plot=e.plot;txt.abs_y=c.yaxis.p2c(median_dataset_expression)+d.top+b;txt.x=e.min_x_axis;txt.width=200;txt.text_align="left";txt.fill_style="#000";draw_text_on_canvas(txt)}}function wrapText(d,j,i){if(d.text==undefined){return false}j=d.maxWidth;i=d.lineHeight;var a=d.plot.getCanvas().getContext("2d");var k=d.text;var c=d.plot.getPlotOffset();var f=d.plot.getAxes();if(d.hasOwnProperty("x")){x=f.xaxis.p2c(d.x)+c.left}if(d.hasOwnProperty("y")){y=f.yaxis.p2c(d.y)+c.top+y_axis_adjustment}if(d.hasOwnProperty("abs_x")){x=d.abs_x}if(d.hasOwnProperty("abs_y")){y=d.abs_y}var h=k.split(" ");var m="";for(var b=0;b<h.length;b++){var e=m+h[b]+" ";var g=a.measureText(e);var l=g.width;if(l>j&&b>0){a.fillText(m,x,y);m=h[b]+" ";y+=i}else{m=e}}a.fillText(m,x,y)}function draw_title(f){var c=f.plot.getAxes();var a=c.yaxis.min;var d=c.yaxis.max;var b=c.xaxis.min;var e=c.xaxis.max;txt=new Object();txt.text=f.cells_samples_assayed;txt.angle=angle_horizontal;txt.plot=f.plot;range=d-a;txt.y=d+(range/10);if(label_dimensions.hasOwnProperty("xaxis_center_label_x")){txt.abs_x=label_dimensions.xaxis_center_label_x}else{txt.x=(e-b)/2}txt.font="16px sans-serif";txt.text_align="center";txt.fill_style="#000";txt.maxWidth=900;txt.lineHeight=16;wrapText(txt);txt.text=f.title_dataset;txt.y=txt.y+(range/15);wrapText(txt);txt.text=f.title+f.title_id+" "+f.title_grouped;txt.y=txt.y+(range/15);draw_text_on_canvas(txt)}function calc_decimal_places(a){temp=1/a;if(temp>0&&temp<=10){return 1}if(temp>10&&temp<=100){return 2}if(temp>100&&temp<=1000){return 3}}function draw_yaxis_labels(f){label_dimensions=f.label_dimensions;var b=f.plot.getAxes();var d=b.yaxis.max;original_min_y=parseInt(f.original_min_y_axis);if(original_min_y<0){var a=original_min_y}else{var a=0}decimal_places=calc_decimal_places(d);if(d>0&&d<1){multiplier=Math.pow(10,decimal_places);a=a*multiplier;d=d*multiplier}else{multiplier=1}for(var c=a;c<=d;c++){var e=c/multiplier;txt=new Object();txt.angle=angle_horizontal;txt.plot=f.plot;txt.font=" 12px sans-serif";txt.abs_x=label_dimensions.yaxis_ticks_abs_x;txt.y=e;txt.text=e;txt.width=200;txt.text_align="right";draw_text_on_canvas(txt)}txt=new Object();txt.text=f.y_axis_label;txt.angle=angle_vertical;txt.plot=f.plot;txt.abs_y=label_dimensions.yaxis_label_abs_y;txt.abs_x=label_dimensions.yaxis_label_abs_x;txt.width=200;txt.text_align="center";draw_text_on_canvas(txt)}function set_detection_threshold_and_median(d,c,b){detection_threshold=d.detection_threshold;min_x_axis=d.min_x_axis;max_x_axis=d.max_x_axis;if(detection_threshold!=undefined&&detection_threshold!=0){c[b]={data:[[min_x_axis,detection_threshold],[max_x_axis,detection_threshold]],color:"blue",label:false,lines:{show:true}};b++}var a=d.median_dataset_expression;if(a!=undefined&&a!=0){c[b]={data:[[min_x_axis,a],[max_x_axis,a]],color:"green",label:false,lines:{show:true}}}return c}Object.prototype.hasOwnProperty=function(a){return this[a]!==undefined};function draw_text_on_canvas(b){var d=b.plot.getCanvas().getContext("2d");var g=b.plot.getPlotOffset();var f=b.plot.getAxes();if(b.hasOwnProperty("x")){x=f.xaxis.p2c(b.x)+g.left}if(b.hasOwnProperty("y")){y=f.yaxis.p2c(b.y)+g.top+y_axis_adjustment}if(b.hasOwnProperty("abs_x")){x=b.abs_x}if(b.hasOwnProperty("abs_y")){y=b.abs_y}d.textBaseline="bottom";d.fillStyle=(b.fill_style!==undefined)?b.fill_style:"#000";d.lineStyle=(b.line_style!==undefined)?b.line_style:"#FFF";d.font=(b.font!==undefined)?b.font:"16px sans-serif";b.large=typeof large!=="undefined"?b.large:false;if(b.large){d.font="50px sans-serif"}d.textAlign=(b.text_align!==undefined)?b.text_align:"left";var e=d.measureText(b.text);d.save();var c=x;var a=y;d.translate(c,a);d.rotate(b.angle);d.translate(-c,-a);d.fillText(b.text,x,y);d.restore()};