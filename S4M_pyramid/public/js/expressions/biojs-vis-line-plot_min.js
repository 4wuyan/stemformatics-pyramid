var biojsvislinegraph;module.exports=biojsvislinegraph=function(a){sort_x_by_probe_and_day_state=function(e){options=e.options;if(options.probe_order!=="none"){var d=options.day_state_order;var c=options.probe_order;var b=d3.nest().key(function(f){return f.Probe}).sortKeys(function(g,f){return c.indexOf(g)-c.indexOf(f)}).key(function(f){return f.Day}).sortKeys(function(g,f){return d.indexOf(g)-d.indexOf(f)}).key(function(f){return f.LineGraphGroup}).entries(options.data)}else{var b=d3.nest().key(function(f){return f.Probe}).key(function(f){return f.Day}).key(function(f){return f.LineGraphGroup}).entries(options.data)}e.nested_values=b;return e};sort_x_by_probe_and_linegroup=function(e){options=e.options;sample_type_count=0;if(options.probe_order!=="none"){var b=options.line_group_order;var d=options.probe_order;var c=d3.nest().key(function(f){return f.Probe}).sortKeys(function(g,f){return d.indexOf(g)-d.indexOf(f)}).key(function(f){return f.LineGraphGroup}).sortKeys(function(g,f){return b.indexOf(g)-b.indexOf(f)}).entries(options.data)}else{var c=d3.nest().key(function(f){return f.Probe}).key(function(f){return f.LineGraphGroup}).entries(options.data)}e.nested_line_group=c;return e};add_line=function(c){var h=c.options;var k=c.nested_line_group;var t=c.stroke_width_for_line;var C=c.scaleY;var B=h.colour_array;var l=c.multiple_sample_mapping;var m=0;var r=c.svg;var q=h.day_state_order;var g=[];for(var u in k){var j=k[u].key;var d=k[u].values;for(var p in d){var n=d[p].key;var A=[];var b=d[p].values;for(i=0;i<b.length;i++){if(b[i].Expression_Value==b[i].Expression_Value){A.push(b[i])}}m=0;for(var o in A){var y=A[o];var w=y.Day;if(!isNaN(y.Expression_Value)){if(w!=m&&m!=0){var v=A[o-1];if(day_state_order.indexOf(y.Day)-day_state_order.indexOf(v.Day)==1){var z=get_x_value(c,v);var x=get_x_value(c,y);var f=l[j+m+n+v.Replicate_ID];var e=l[j+w+n+y.Replicate_ID];if(f==undefined||isNaN(f)){f=v.Expression_Value}if(e==undefined||isNaN(e)){e=y.Expression_Value}if(isNaN(f)||isNaN(e)){f=0;e=0}r=add_scatter_line(r,B[n],z,x,C(f),C(e),t)}}m=w}}}}c.svg=r;return c};setup_line_graph=function(g){var l=g.options;var r=g.nested_values;var x=l.stroke_width;var f=l.box_width;var k=f/2;var D=g.scaleY;var B=l.colour_array;var p=[];var j=[];var e={};if(l.sort_by_sample_id==="no"){for(var z in r){var q=r[z];var h=q.values;var m=q.key;var t=parseInt(z);for(var C in h){var s=h[C];var o=s.values;day=s.key;for(var w in o){var c=o[w].values;var v=o[w].key;var n=get_x_value(g,c[0]);var u=B[v];if(c.length!=1){p=[];expression_vals=[];for(var F in c){if(!isNaN(c[F].Expression_Value)){p.push(c[F].Replicate_ID);expression_vals.push(c[F].Expression_Value)}}if(expression_vals.length!=0){var b=make_scatter_tooltip(m,v,day,p,p,"Day: ");var A=calculate_error_bars(expression_vals);var E="none";svg=add_line_to_box(x,n-k/2,f/2,A[0],svg,D,u,k/2,undefined,g,E);svg=add_line_to_box(x,n-k/2,f/2,A[2],svg,D,u,k/2,undefined,g,E);svg=add_vertical_line_to_box(x,n,A[0],A[2],svg,D,u,g,E);svg=add_single_scatter(A[1],n,g,b,v);for(var y in p){e[m+day+v+p[y]]=A[1]}}}else{if(!isNaN(c[0].Expression_Value)){var b=make_scatter_tooltip(m,v,day,c[0].Sample_Type,c[0].Replicate_ID,"Day: ");svg=add_single_scatter(c[0].Expression_Value,n,g,b,v)}}}}}}else{data=l.data;if(l.sample_id_order!=="none"){sample_order=l.sample_id_order;data.sort(function(G,d){return sample_order.indexOf(G.Replicate_ID)-sample_order.indexOf(d.Replicate_ID)})}else{data.sort(function(G,d){return G.Replicate_ID.localeCompare(d.Replicate_ID)})}id_size=l.width/data.length;scale_x=d3.scale.ordinal().rangePoints([id_size/2,l.width-id_size/2]);scale_x.domain(l.sample_id_list);g.scale_x=scale_x;g.id_size=id_size;g=add_scatter_for_sample_ids(data,g,l.colour,scale_x);if(l.include_day_x_axis==="yes"){g=setup_extra_labels(g,scale_x,0)}}g.multiple_sample_mapping=e;return g};add_single_scatter=function(c,f,d,e,b){options=d.options;radius=options.radius;scaleY=d.scaleY;if(e!==null){svg.call(e)}svg.append("circle").attr("class",function(g){return"sample-type-"+b}).attr("r",radius).attr("cx",f).attr("cy",scaleY(c)).style("stroke",options.background_stroke_colour).style("stroke-width","1px").style("fill",function(g){return options.colour_array[b]}).attr("opacity",0.8).on("mouseover",e.show).on("mouseout",e.hide);return svg};make_day_label_tooltip=function(){var b=d3.tip().attr("class","d3-tip").offset([150,-50]).html(function(c){temp=c.substring(c.lastIndexOf("-")+1)+"<br/>";return temp});return b};setup_day_labels=function(m,f,g,e,j){svg=m.svg;var c=m.name_mapping_with_space;page_options=m.page_options;options=m.options;var h=m.multi_xaxis_list;var l=make_day_label_tooltip();svg.call(l);var k=h.length;var b=m.multi_scaleX;var d;svg.selectAll(g).data(h).enter().append("text").text(function(p,o){var n=p.substring(p.lastIndexOf("-")+1);return n}).attr("class","x_axis_diagonal_labels").style("text-anchor","end").attr("id",function(n){}).attr("y",page_options.height+f).attr("x",function(o,n){var p=b(c[o]);return p}).style("font-family",options.font_style).style("font-size",options.text_size).attr("transform",function(p,o){var q=b(c[p]);var n=page_options.height+f;return"rotate("+options.x_axis_text_angle+","+q+","+n+")"}).on("mouseover",function(o){var n=o.substring(o.lastIndexOf("-")+1);var p=d3.select("body").append("div").attr("id","x-axis-tooltip").attr("class","d3-tip").text(n).style("left",(d3.event.pageX-50)+"px").style("top",(d3.event.pageY-50)+"px").style("display","inline").style("opacity","1");return p}).on("mouseout",function(n){$("#x-axis-tooltip").remove()});m.svg=svg;return m};test_values=function(c,e,d,b){row=c+","+0+","+0+","+e[0]+","+e[4]+","+e[2]+","+e[1]+","+e[3];if(b.bar_graph==="yes"){row=c+","+e[1]+","+0+","+e[0]+","+e[2]+","+0+","+0+","+0}};get_type=function(b){return b};setup_graph=function(d){d.graph_type="Line Graph";var c=".probe_text";var e=".probe-";options=d.options;var b=options.x_axis_label_padding;d=setup_margins(d);d=setup_svg(d);if(options.sort_by_sample_id==="no"){d=sort_x_by_probe_and_day_state(d)}d=sort_x_by_probe_and_linegroup(d);d=setup_x_axis(d,options.x_axis_list);d=setup_data_for_x_axis(d);d=setup_day_labels(d,b,c,e,1);b=b-100;d=setup_x_axis_labels(d,null,b,c,e,1);d=setup_x_axis_labels(d,null,b,".hidden-probe_text",e,1);d=setup_y_axis(d);d=setup_line_graph(d);d=add_line(d);d=setup_vertical_lines(d);if(options.display.vertical_lines==="yes"){d=setup_vertical_lines(d)}d=setup_watermark(d);if(options.display.legend==="yes"){d=setup_D3_legend(d,options.legend_list)}if(options.display.horizontal_lines==="yes"){d=setup_horizontal_lines(d)}return d};init=function(b){var c=default_options();c=b;page_options={};var d={};d.options=c;d=preprocess_lines(d);d=setup_graph(d);var e=$(c.target);e.addClass("line_graph");svg=d.svg;c.test_graph=d};init(a)};