var biojsvisyugenegraph;var brush;var dots;var svg_line;var full_data;brushmove=function(b){var a=brush.extent();dots.classed("selected",function(c){end=a[0];start=a[1];position=c.x_position;result=end<=position&&position<=start;return result});end=Math.floor(a[0]);start=Math.floor(a[1])+1;selection_yugene_value_end=full_data[end-1].yugene_value;if(full_data.length<start){start=full_data.length}selection_yugene_value_start=full_data[start-1].yugene_value;$("#yugene_value_end").html(selection_yugene_value_end);$("#yugene_value_start").html(selection_yugene_value_start)};module.exports=biojsvisyugenegraph=function(a){this.d3_wrap=function(c,b){c.each(function(){var j=d3.select(this),f=j.text().split(/\s+/).reverse(),d,l=[],e=0,i=1.1,g=j.attr("y"),h=j.attr("x"),k=parseFloat(j.attr("dy"));if(isNaN(k)){k=0}else{k=k}tspan=j.text(null).append("tspan").attr("x",h).attr("y",g).attr("dy",k+"em");while(d=f.pop()){l.push(d);tspan.text(l.join(" "));if(tspan.node().getComputedTextLength()>b){l.pop();tspan.text(l.join(" "));l=[d];new_dy=++e*i+k;tspan=j.append("tspan").attr("x",h).attr("y",g).attr("dy",new_dy+"em").text(d).attr("text-anchor","middle")}}})};this.setup_margins=function(b){options=b.options;page_options.width=options.width-options.margin.left-options.margin.right;page_options.height=options.height-options.margin.top-options.margin.bottom;page_options.horizontal_grid_lines=0;page_options.margin_top=options.margin.top;page_options.margin_bottom=options.margin.bottom;page_options.full_width=options.width+options.margin.left+options.margin.right;page_options.full_height=options.height;page_options.margin=options.margin;b.page_options=page_options;return b};this.setup_yugene_line=function(c){options=c.options;scaleX=c.scaleX;scaleY=c.scaleY;svg=c.svg;height=c.options.height-c.options.margin.top-c.options.margin.bottom;yugene_line=d3.svg.line().x(function(f,e){value=f[options.x_column];return scaleX(value)}).y(function(e){value=e[options.y_column];return scaleY(value)});var b=d3.svg.area().x(function(f,e){value=f[options.x_column];return scaleX(value)}).y1(function(e){value=e[options.y_column];return scaleY(value)}).y0(height);svg_line=svg.append("path").attr("class",function(){return"class-for-path"}).style("opacity",100).style("fill","none").style("stroke","black").style("stroke-width","1").attr("d",yugene_line(options.data));svg_area=svg.append("path").style("opacity",100).style("fill",options.fill_area_colour).attr("d",b(options.data));c.svg_area=svg_area;c.svg_line=svg_line;c.svg=svg;return c};this.setup_y_axis=function(d){svg=d.svg;var c=d3.scale.linear().range([page_options.height,0]);var b=d3.svg.axis().scale(c).orient("left").ticks(options.increment).innerTickSize(-page_options.horizontal_grid_lines).outerTickSize(0);y_column=options.y_column;max_value=1;min_value=0;c.domain([min_value,max_value]).nice();y_axis_legend_y=(d.full_height-options.margin.top-options.margin.bottom)/2;svg.append("text").text(options.y_axis_title).attr("text-anchor","middle").style("font-family","sans-serif").style("font-size","16px").attr("transform","rotate(-90)").style("text-anchor","middle").attr("x",-y_axis_legend_y).attr("y",-options.padding);svg.append("g").attr("class","grid").call(b);d.svg=svg;d.scaleY=c;d.yAxis=b;return d};this.setup_x_axis=function(c){page_options=c.page_options;svg=c.svg;options=c.options;extra_y=24;width=page_options.width;var b=d3.scale.linear().range([0,width]);b.domain(d3.extent(options.data,function(e){return e[options.x_column]}));svg.append("text").attr("class","label").attr("x",(page_options.width+page_options.margin.left+page_options.margin.right)/2).attr("y",+page_options.height+extra_y).style("text-anchor","end").style("font-family","sans-serif").text(options.x_axis_title);c.svg=svg;c.scaleX=b;return c};this.brushstart=function(){svg.classed("selecting",true)};this.brushend=function(){svg.classed("selecting",!d3.event.target.empty());get_breakdown_of_filtered_data()};this.calculate_difference_between_samples=function(b,c){prev_sample_id=b[0];step_sample_id=b[1];value=c(step_sample_id)-c(prev_sample_id);return value};this.setup_show_points_on_line=function(c){ds_id_array=c.options.ds_id_array;svg=c.svg;options=c.options;page_options=c.page_options;scaleX=c.scaleX;scaleY=c.scaleY;y_column=options.y_column;x_column=options.x_column;tooltip=options.tooltip;var b=-1;radius=options.circle_radius;probes=new Array();dots=svg.selectAll(".dot").data(options.data.filter(function(e){result=$.inArray(e.ds_id,ds_id_array)!==-1;return result})).enter().append("circle").attr("class",function(e){return"text-to_change_later"}).attr("r",radius).attr("cx",function(f){var e=scaleX(f[options.x_column]);return e}).attr("cy",function(e){var f=scaleY(e[options.y_column]);return f}).style("stroke","black").style("stroke-width","0px").style("fill",function(e){result=$.inArray(e.ds_id,ds_id_array);if(result!==-1){colour=options.colour[result]}return colour}).on("mouseover",tooltip.show).on("mouseout",tooltip.hide);c.dots=dots;c.svg=svg;return c};this.setup_svg=function(c){options=c.options;page_options=c.page_options;full_width=page_options.full_width;full_height=page_options.full_height;c.full_width=full_width;c.full_height=full_height;background_stroke_width=options.background_stroke_width;background_stroke_colour=options.background_stroke_colour;$(options.target).html("").css("width",full_width+"px").css("height",full_height+"px");var b=d3.select(options.target).append("svg").attr("width",full_width).attr("height",full_height).append("g").attr("transform","translate("+page_options.margin.left+","+page_options.margin.top+")");b.append("rect").attr("class","background_rect").attr("width",page_options.width).attr("height",page_options.height).attr("stroke-width",background_stroke_width).attr("stroke",background_stroke_colour).attr("fill",options.background_colour);height_margin_multiplier=2;height_margin=10;height_divisor=1.5;b.append("text").attr("x",page_options.width/2).attr("y",0-(page_options.margin.top/height_divisor)+(height_margin/height_margin_multiplier)).attr("text-anchor","middle").text(options.title).attr("class",options.title_class).style("fill","black").style("font-family","sans-serif").style("font-size","16px").attr("class",options.title_class);max_width_of_text=600;suggested_width_of_text=options.width*0.7;if(max_width_of_text<suggested_width_of_text){width_of_title=max_width_of_text}else{width_of_title=suggested_width_of_text}b.selectAll("."+options.title_class).call(this.d3_wrap,width_of_title);c.svg=b;return c};this.setup_watermark=function(b){svg=b.svg;options=b.options;extra_padding=0;svg.append("image").attr("xlink:href",options.watermark).attr("x",page_options.height/2-100).attr("y",-page_options.width-2*options.padding-extra_padding).attr("transform","rotate(+90)").attr("width",200).attr("height",100);b.svg=svg;return b};this.setup_graph=function(b){b=this.setup_margins(b);b=this.setup_svg(b);b=this.setup_x_axis(b);b=this.setup_y_axis(b);b=this.setup_yugene_line(b);b=this.setup_show_points_on_line(b);if(b.options.watermark!=false){b=this.setup_watermark(b)}return b};this.setup_brush=function(d){scaleX=d.scaleX;brush=d3.svg.brush().x(scaleX).extent([10,50]).on("brushstart",this.brushstart).on("brush",brushmove).on("brushend",this.brushend);height=d.page_options.height;radius=5;var c=d3.svg.arc().outerRadius(radius).startAngle(0).endAngle(function(f,e){return e?-Math.PI:Math.PI});var b=svg.append("g").attr("class","brush").style("fill-opacity",0).call(brush);b.selectAll(".resize").append("path").attr("transform","translate(0,"+height/2+")").attr("d",c);b.selectAll("rect").attr("height",height);d.brushg=b;return d};this.init=function(b){var c=b;page_options={};var d={};d.options=c;full_data=c.data;d=this.setup_graph(d);var e=$(c.target);e.addClass("scatter_plot");if(c.setup_brush==true){d=this.setup_brush(d);this.brushstart();brushmove(d)}svg=d.svg};this.init(a)};