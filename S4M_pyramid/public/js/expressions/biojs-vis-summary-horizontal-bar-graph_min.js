var biojsvissummaryhorizontalbargraph;module.exports=biojsvissummaryhorizontalbargraph=function(a){this.d3_wrap=function(c,b){c.each(function(){var h=d3.select(this),g=h.text().split(/\s+/).reverse(),f,e=[],d=h.attr("dy");y=h.attr("y");line_height=options.line_height;tspan=h.text(null).append("tspan").attr("y",y).attr("class","multi_level_text_first").attr("dy",0);i=0;while(f=g.pop()){i++;e.push(f);tspan.text(e.join(" "));if(tspan.node().getComputedTextLength()>b){e.pop();tspan.text(e.join(" "));e=[f];new_dy=parseFloat(d)+(parseFloat(line_height)/2);tspan=h.append("tspan").attr("dy",new_dy).attr("x",0).attr("y",0).text(f).attr("class","multi_level_text_other").attr("text-anchor","left")}}});$("text.label_name .multi_level_text_other").each(function(){first_label=$(this).siblings(".multi_level_text_first");dy=first_label.attr("dy");new_dy=parseFloat(dy)-(parseFloat(line_height)/2);first_label.attr("dy",new_dy)})};this.setup_margins=function(b){options=b.options;page_options.margin=options.margin;page_options.width=options.width;page_options.margin_top=options.margin.top;page_options.margin_bottom=options.margin.bottom;page_options.width_whole=page_options.width-options.margin.left-options.margin.right;page_options.height=options.height-options.margin.top-options.margin.bottom;page_options.horizontal_grid_lines=options.horizontal_grid_lines;page_options.full_width=options.width+options.margin.left+options.margin.right;page_options.full_height=options.height;b.page_options=page_options;return b};this.setup_y_axis=function(d){svg=d.svg;max=d.max_val;options=d.options;var c=d3.scale.linear().range([page_options.height+options.gap_between_groups,0]);var b=d3.svg.axis().scale(c).tickFormat("").tickSize(0).orient("left");d.svg=svg;d.scaleY=c;d.yAxis=b;return d};this.setup_x_axis=function(c){page_options=c.page_options;svg=c.svg;options=c.options;data=options.data;extra_y=24;width=page_options.width;horizontal_space_for_labels=options.horizontal_space_for_labels;inner_margin=options.inner_margin;if(options.order_by=="count"){max_d_number=d3.max(data,function(e){return e.number})}else{max_d_number=d3.max(data,function(e){return e.coverage})}var b=d3.scale.linear().domain([0,max_d_number]).range([0,width-2*horizontal_space_for_labels-inner_margin]);svg.append("text").attr("class","label").attr("x",page_options.width/2).attr("y",+page_options.height+extra_y).style("text-anchor","end").text(options.x_axis_title);c.svg=svg;c.scaleX=b;return c};make_label_tooltip=function(){var b=d3.tip().attr("class","d3-tip").html(function(c){temp=c.hover+"<br/>";return temp});return b};this.setup_bar=function(h){ds_id_array=h.options.ds_id_array;size_options=h.size_options;svg=h.svg;options=h.options;page_options=h.page_options;scaleX=h.scaleX;scaleY=h.scaleY;var g=make_label_tooltip();svg.call(g);y_column=options.y_column;x_column=options.x_column;data=options.data;horizontal_space_for_labels=options.horizontal_space_for_labels;inner_margin=options.inner_margin;bar_height=(page_options.height-2*inner_margin)/(data.length);gap_between_groups=options.gap_between_groups;line_height=options.line_height;line_y_adjustment=options.line_y_adjustment;var j=25;var f=290;var d=757;var c=svg.append("text").attr("transform",function(){return"translate("+(f)+","+(j)+")"});c.append("tspan").text(function(){return"Samples"}).attr("width",horizontal_space_for_labels).attr("text-anchor","end").attr("font-weight","bold").style("font-family","sans-serif");var b=svg.append("text").attr("transform",function(){return"translate("+(f+10)+","+(j-1)+")"});b.append("tspan").text(function(){return"[Samples highlighted / total of samples with that term in YuGene]"}).attr("width",horizontal_space_for_labels).attr("text-anchor","start").style("font-size","14px").style("font-family","sans-serif");var e=svg.selectAll("g").data(data).enter().append("g").attr("transform",function(l,k){test=l;return"translate("+(horizontal_space_for_labels)+","+((k*bar_height)+inner_margin+j)+")"}).on("click",function(k){ensembl_id=$("#ensemblID").html();db_id=$("#db_id").html();symbol=$("#symbol").html();filter_start=$("#yugene_value_start").html();filter_end=$("#yugene_value_end").html();window.open("/expressions/show_yugene_filtered_dataset_breakdown?generic_sample_type="+encodeURIComponent(k.name)+"&db_id="+db_id+"&ensembl_id="+ensembl_id+"&symbol="+symbol+"&filter_start="+filter_start+"&filter_end="+filter_end)});color=d3.scale.category20();e.append("rect").attr("fill",function(l,k){return color(k)}).attr("width",function(k){if(options.order_by=="count"){return scaleX(k.number)}else{return scaleX(k.coverage)}}).attr("height",bar_height-gap_between_groups);e.append("text").text(function(l){var k=l.name;if(k.length>=options.max_length_of_generic_sample_type){k=k.substring(0,options.max_length_of_generic_sample_type-3);k=k+" ..."}return k}).attr("class","label_name").attr("width",horizontal_space_for_labels).attr("text-anchor","end").style("font-family","sans-serif").attr("dy",-line_y_adjustment).attr("transform",function(l,k){return"translate(-"+inner_margin+","+(0.5*bar_height+gap_between_groups)+")"}).on("mouseover",g.show).on("mouseout",g.hide);e.append("text").text(function(m){var l=m.number;var k=m.full_count;if(options.order_by=="count"){return l.toString()+"/"+k+" ["+parseInt((l/k)*100)+"%]"}else{return parseInt((l/k)*100)+"% ["+l.toString()+"/"+k+"]"}}).attr("class","label_number").style("font-family","sans-serif").attr("transform",function(l,k){if(options.order_by=="count"){return"translate("+(scaleX(l.number)+inner_margin)+","+(0.5*bar_height+gap_between_groups)+")"}else{return"translate("+(scaleX(l.coverage)+inner_margin)+","+(0.5*bar_height+gap_between_groups)+")"}});svg.selectAll(".label_name").call(this.d3_wrap,horizontal_space_for_labels-inner_margin);h.svg=svg;return h};this.setup_legend=function(b){return b};this.setup_svg=function(c){options=c.options;page_options=c.page_options;full_width=page_options.full_width;full_height=page_options.full_height;c.full_width=full_width;c.full_height=full_height;background_stroke_width=options.background_stroke_width;background_stroke_colour=options.background_stroke_colour;extra_height_padding=30;$(options.target).html("").attr("class","summary_horizontal_bar_graph").css("width",full_width+"px").css("height",full_height+"px");var b=d3.select(options.target).append("svg").attr("width",full_width).attr("height",full_height);var d=b.append("g").attr("class","dropdown");var b=b.append("g").attr("class","sample_breakdown").attr("transform","translate("+page_options.margin.left+","+page_options.margin.top+")");b.append("rect").attr("width",page_options.width).attr("height",page_options.height+extra_height_padding).attr("stroke-width",background_stroke_width).attr("stroke",background_stroke_colour).attr("fill",options.background_colour);height_margin=options.height_margin_for_title;b.append("text").attr("x",page_options.width/2).attr("y",-height_margin).attr("text-anchor","middle").text(options.title).attr("class",options.title_class).style("font-family","Arial").style("font-size",size_options.title_text).style("fill","black").attr("class",options.title_class);max_width_of_text=600;suggested_width_of_text=options.width*0.7;if(max_width_of_text<suggested_width_of_text){width_of_title=max_width_of_text}else{width_of_title=suggested_width_of_text}b.selectAll("."+options.title_class).call(this.d3_wrap,width_of_title);c.svg=b;return c};this.setup_graph=function(b){b=this.setup_margins(b);b=this.setup_svg(b);b=this.setup_x_axis(b);b=this.setup_y_axis(b);b=this.setup_bar(b);return b};this.init=function(b){options=b;page_options={};size_options={};var c={};c.options=options;c=this.setup_graph(c);var d=$(options.target);svg=c.svg};this.init(a)};