var biojsvisscatterplot;module.exports=biojsvisscatterplot=function(a){setup_scatter_line=function(b){scatter_line=d3.svg.line().x(function(e,c){return scaleX(e[options.x_column])}).y(function(c){return scaleY(c.Expression_Value)});dataNest=d3.nest().key(function(c){return c.Probe}).entries(options.data);colour=options.colour;colour_count=0;dataNest.forEach(function(e,c){svg.append("path").attr("class",function(){return"line-probe-"+remove_chars(e.key)}).style("stroke",function(){colour_count++;if(c%options.number_of_colours===0){colour_count=0}return colour[colour_count]}).style("stroke-width",options.line_stroke_width).attr("id","tag"+remove_chars(e.key)).style("opacity",1).attr("fill","none").attr("d",scatter_line(e.values))});b.svg=svg;return b};get_x_value_scatter=function(h,g){var e=h.multi_scaleX;var d=g.Replicate_ID;var f=h.options.split_sort_by_option;if(options.multi_group!=1){var b=g[f[0]];var c=g[f[1]];var j=h.name_mapping[remove_chars(b+"-"+d+"-"+c)];centreX=e(j)}else{var j=h.name_mapping[remove_chars(g[f[0]]+"-"+d)];centreX=e(j)}return centreX};sort_scatter_data=function(c){options=c.options;sample_type_count=0;var b=options.sortByOption.split(",");if(options.sortByOption==null){sample_type_order=options.sample_type_order.split(",");nested_values=d3.nest().key(function(e){return e.Sample_Type}).sortKeys(function(e,d){return sample_type_order.indexOf(e)-sample_type_order.indexOf(d)}).key(function(e){return e.Replicate_ID}).entries(options.data)}else{if(options.sortByOption!="null"){sample_type_order=options.sample_type_order.split(",");if(b.length==1&&options.sortByOption=="Sample_Type"){nested_values=d3.nest().key(function(f){var e=b[0];return f[e]}).sortKeys(function(e,d){return sample_type_order.indexOf(e)-sample_type_order.indexOf(d)}).key(function(e){return e.Replicate_ID}).entries(options.data)}else{if(b.length==1&&options.sortByOption!="Sample_Type"){nested_values=d3.nest().key(function(f){var e=b[0];return f[e]}).key(function(e){return e.Replicate_ID}).entries(options.data)}else{nested_values=d3.nest().key(function(f){var e=b[0];return f[e]}).key(function(f){var e=b[1];return f[e]}).sortKeys(function(e,d){return sample_type_order.indexOf(e)-sample_type_order.indexOf(d)}).key(function(e){return e.Replicate_ID}).entries(options.data)}}}}c.nested_values=nested_values;return c};setup_scatter=function(c){svg=c.svg;options=c.options;page_options=c.page_options;scaleX=c.multi_scaleX;scaleY=c.scaleY;y_column=options.y_column;x_column=options.x_column;tooltip=options.tooltip;svg.call(tooltip);var b=-1;radius=options.circle_radius;probes=new Array();color_object={};for(i=0;i<options.probes.length;i++){color_object[options.probes[i]]=options.colour_array[options.probes[i]]}svg.selectAll(".dot").data(options.data).enter().append("circle").attr("class",function(e){if(isNaN(e[options.y_column])){return}return"sample-type-"+options.sample_types[e.Sample_Type]}).attr("id",function(e){if(isNaN(e[options.y_column])){return}return"scatter-point-"+e.Replicate_ID}).attr("r",function(e){if(isNaN(e[options.y_column])){return}else{return radius}}).attr("cx",function(f){if(isNaN(f[options.y_column])){return}var e=get_x_value_scatter(c,f);return e}).attr("cy",function(e){if(isNaN(e[options.y_column])){return}var f=scaleY(e[options.y_column]);return f}).style("stroke","black").style("stroke-width",function(e){if(isNaN(e[options.y_column])){return"0px"}else{return"1px"}}).style("fill",function(e){if(isNaN(e[options.y_column])){return}return options.colour_array[e.Probe]}).on("mouseover",tooltip.show).on("mouseout",tooltip.hide);c.svg=svg;return c};set_data_order=function(b){if(options.sample_type_order!=="none"){options.data.sort(function(e,d){var c=e.Sample_Type;var f=d.Sample_Type;return c<f?-1:c>f?1:0})}return b};get_type=function(b){return b};setup_graph=function(d){d.graph_type="Scatter Plot";options=d.options;var b=options.x_axis_label_padding;var c=".sample_type_text";var g=".second_sort_by";var f=".sample-type-";d=setup_margins(d);d=setup_svg(d);d=sort_scatter_data(d);d=setup_data_for_x_axis(d);d=setup_x_axis(d,d.sample_id_list);if(options.display.x_axis_labels==="yes"){d=setup_x_axis_labels(d,d.sample_id_list,b,g,f,1);if(options.multi_group!=1){b+=80;d=setup_x_axis_labels(d,d.sample_id_list,b,c,f,2)}}d=setup_y_axis(d);if(options.display.vertical_lines==="yes"){d=setup_vertical_lines(d,d.sample_id_list)}if(options.display.legend==="yes"){d=setup_D3_legend(d,options.legend_list);var e=".hidden_legend";d=setup_D3_legend(d,options.legend_list,e)}if(options.whiskers_needed==true){d=setup_error_bars(d)}if(options.display.horizontal_lines==="yes"){d=setup_horizontal_lines(d)}d=setup_watermark(d);if(options.display.hoverbars==="yes"){d=setup_hover_bars(d)}d=setup_scatter(d);if(scaling_required=="yes"){$(".x_axis_label").hide();$(".y_axis_label").hide();$(".main-title").hide()}return d};init=function(b){var c=default_options();c=b;page_options={};var d={};d.options=c;d=preprocess_lines(d);d=setup_graph(d);var e=$(c.target);e.addClass("scatter_plot");svg=d.svg};init(a)};