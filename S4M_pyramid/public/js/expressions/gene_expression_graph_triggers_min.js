var small_width=1275;var large_width=4300;var small_height=900;var large_height=2500;var largeWidth=4000;var AUTOCOMPLETE_TIMEOUT=5000;var standardHeight=964;var standardIE7Height=984;var ie7ChangeInnerDiv=758;var ds_id=0;var db_id="";var this_graph_data={};function afterGraphDrawn(){db_id=this_graph_data.view_data.db_id;contextHelpClick();check_remove_loading();hide_tables();add_buttons_for_viewing_graph_tables();set_draggables();plot_hover();set_clicks()}function set_draggables(){$("div.movable_legend").draggable()}function set_autocomplete(){set_gene_search_and_autocomplete();set_probe_search_and_autocomplete();set_feature_search_and_autocomplete()}function set_gene_search_and_autocomplete(){if($("#geneSearchForm").is(":visible")){$("#geneSearch").autocomplete({source:BASE_PATH+"genes/get_autocomplete?db_id="+db_id,minLength:4,timeout:AUTOCOMPLETE_TIMEOUT,appendTo:".searchBox",select:function(a,b){var c=b.item.ensembl_id;change_gene(c)}}).data("ui-autocomplete")._renderItem=function(a,b){return $("<li></li>").append("<a> <div class='symbol'>"+b.symbol+"</div><div class='species'>"+b.species+"</div><div class='aliases'>"+b.aliases+"</div><div class='description'>"+b.description+"</div><div class='clear'></div></a>").appendTo(a)};$("#geneSearch").keypress(function(a){if(a.which==13){a.preventDefault();var b=$("#geneSearch").val();change_gene(b);return false}});$("#geneSearchForm").unbind();$("#geneSearchForm").submit(function(){$("#geneSearch").autocomplete("close");var a=$("#geneSearch").val();change_gene(a);return false})}}function set_probe_search_and_autocomplete(){$("#probeSearch").autocomplete({source:BASE_PATH+"datasets/autocomplete_probes_for_dataset?ds_id="+ds_id,minLength:2,timeout:AUTOCOMPLETE_TIMEOUT,appendTo:".searchBox",select:function(b,c){var a=c.item.value;chosen_probe_action(a)}});$("#viewProbes,#probeSearchSubmit").click(function(){var a=$("#probeSearch").val();chosen_probe_action(a);return false});$("#probeSearchForm").submit(function(b){b.preventDefault();var a=$("#probeSearch").val();chosen_probe_action(a);return false})}function set_feature_search_and_autocomplete(){var a="default";var b=new Object();b.id="#featureSearch";b.data_url=BASE_PATH+"genes/get_feature_search_autocomplete?feature_type=all&db_id="+db_id;b.target_url=BASE_PATH+"expressions/feature_result?graphType="+a+"&datasetID="+ds_id+"&feature_type=miRNA&db_id="+db_id+"&feature_id=";b.append_to=".searchBox";setup_feature_search_autocomplete(b);$("#featureSearchSubmit").click(function(){chosen_feature_action();return false});$("#featureSearchForm").submit(function(c){c.preventDefault();chosen_feature_action();return false})}function check_remove_loading(){if($("div.legend").length!=0){$("div.loading").removeClass("loading")}}function hide_tables(){$("#showTableData"+ds_id+" table").hide();$("#showRawTableData"+ds_id+" table").hide();$("#zoomGraphTableButton").hide()}function add_buttons_for_viewing_graph_tables(){$("#showGraphTableButton").click(function(){$("#showTableData"+ds_id+" table").toggle();$("#zoomGraphTableButton").toggle()});$("#zoomGraphTableButton").click(function(){if($("#showTableData"+ds_id+" td").css("font-size")=="8px"){$("#showTableData"+ds_id+" td").css("font-size","12px");$(this).html("- COLLAPSE TABLE")}else{$("#showTableData"+ds_id+" td").css("font-size","8px");$(this).html("+ EXPAND TABLE")}})}function plot_hover(){var a=null;$(this_graph_data.view_data.graph_id).bind("plothover",function(e,f,d){if(d){if(a!=d.datapoint){a=d.datapoint;$("#tooltip").remove();graph_type=this_graph_data.view_data.graph_type;var b=f.pageX.toFixed(2),c=f.pageY.toFixed(2);intX=parseInt(b);intY=parseInt(c);offset=this_graph_data.view_data.plot.offset();switch(graph_type){case"scatter":probe=d.series.label;sample_number=d.datapoint[0];expression_value=d.series.data[sample_number-1][1];sample_id=d.series.data[sample_number-1][2];description=sample_id+" - "+probe;break;case"bar":case"box":description=d.series.hoverLabel;break;case"line":description=d.series.hoverLabel+" ["+d.series.show_xaxis_labels_full[d.dataIndex]+"]";break}showTooltip(intX-offset.left+210,intY-offset.top+170,description)}}else{$("#tooltip").remove();a=null}})}function showTooltip(a,c,b){$('<div id="tooltip">'+b+"</div>").css({position:"absolute",display:"none",top:c,left:a,border:"1px solid #fdd",padding:"2px","z-index":101,"background-color":"#fee",opacity:0.8}).appendTo(this_graph_data.view_data.graph_id).fadeIn(200)}function click_linkButtons(){$("a.linkButtons").click(function(a){if($(this).attr("id")!="help"){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}}})}function set_clicks(){click_choose_graph_type();click_toggle_sd();click_choose_sort_type();click_zoom_horizontal();click_no_set_min_y_axis();click_choose_datasets();click_gene_info();click_view_genes();click_export_functions();click_share_link();click_linkButtons();click_select_probes()}function click_select_probes(){$("#toggle_select_probes").unbind();$("#toggle_select_probes").on("click",function(){if(this_graph_data.view_data.click_to_select_probes==false){this_graph_data.view_data.click_to_select_probes=true;selectGraphToDraw();probe_name_element=$("#probe_name");if(probe_name_element.length){probe_name=probe_name_element.html()}else{probe_name="Probe"}new_html='<div id="store_and_submit_select_probes" class="select_probes"><div class="title">Select '+probe_name+'s</div><div class="help">Click on the '+probe_name+'s under the graph to select and then submit to view them</div><textarea></textarea><input type="submit"></submit></div>';$("body").append(new_html);$("div.select_probes").draggable();$("div.select_probes input").click(function(){var b=new URL(document.URL);var a=$("div.select_probes textarea").val();a=a.replace(/\s{1,}/g,DELIMITER);b.get_data.select_probes=encodeURIComponent(a);new_url=b.get_url();window.location=new_url})}else{if(this_graph_data.view_data.click_to_select_probes==true){this_graph_data.view_data.click_to_select_probes=false;selectGraphToDraw();$("div.select_probes input").unbind();$("div.select_probes").draggable("disable");$("#store_and_submit_select_probes").remove()}}})}function toggle_standard_deviation(){var a=this_graph_data.view_data.show_standard_deviation;if(a=="on"){this_graph_data.view_data.show_standard_deviation="off"}else{this_graph_data.view_data.show_standard_deviation="on"}selectGraphToDraw()}function check_choose_dataset_immediately(){this_graph_data.choose_dataset_immediately=$("#choose_dataset_immediately").html();if(this_graph_data.choose_dataset_immediately=="True"){$("#chooseDatasets").click()}}function chosen_probe_action(b){var a="default";window.location=BASE_PATH+"expressions/probe_result?graphType="+a+"&datasetID="+ds_id+"&probe="+encodeURIComponent(b)+"&db_id="+db_id}function chosen_feature_action(){var a="default";var b=$("#featureSearch").val().replace("+","%2B");window.location=BASE_PATH+"expressions/feature_result?graphType="+a+"&datasetID="+ds_id+"&feature_type=miRNA&feature_id="+encodeURIComponent(b)+"&db_id="+db_id}function change_gene(a){if(a!=""&&a!=undefined){graph_type=this_graph_data.view_data.graph_type;sort_by=this_graph_data.view_data.sort_by;if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.host}new_url=window.location.origin+window.location.pathname+"?graphType="+graph_type+"&datasetID="+ds_id+"&gene="+a+"&db_id="+db_id+"&sortBy="+sort_by;window.location=new_url}}function set_large(){if(CURRENT_URL.queryKey.size=="large"){$(this_graph_data.view_data.graph_id).height(large_height).width(large_width)}else{$(this_graph_data.view_data.graph_id).height(small_height).width(small_width)}}function click_choose_graph_type(){$("a.chooseGraphType").unbind();$("a.chooseGraphType").on("click",function(){var a=$(this).attr("clickChoose");var c=window.location.href;switch(a){case"scatter":var b=c.replace(/graphType=[A-za-z]*/g,"graphType=scatter");break;case"bar":var b=c.replace(/graphType=[A-za-z]*/g,"graphType=bar");break;case"line":var b=c.replace(/graphType=[A-za-z]*/g,"graphType=line");break;case"box":var b=c.replace(/graphType=[A-za-z]*/g,"graphType=box");break}var b=b.replace("&size=large","");window.location=b})}function click_toggle_sd(){$("#toggleSD,a.toggle_sd").unbind();$("#toggleSD,a.toggle_sd").click(function(){toggle_standard_deviation()})}function click_choose_sort_type(){$("a.chooseSortType").unbind();$("a.chooseSortType").click(function(){var a=$(this).attr("clickChoose");$(this).addClass("bold");var c=window.location.href;var b=c.replace("#","").replace("%20").replace(/\&sortBy=[A-za-z 0-9\-]*/g,"");b=b+"&sortBy="+a;window.location=b})}function click_zoom_vertical(){$("#zoomVerticalGraphButton").unbind();$("#zoomVerticalGraphButton").click(function(){var a=$(this_graph_data.view_data.graph_id).css("height");if(a=="503px"){$(this_graph_data.view_data.graph_id).css("height","200px");selectGraphToDraw()}else{$(this_graph_data.view_data.graph_id).css("height","503px");selectGraphToDraw()}})}function click_zoom_horizontal(){graph_id=this_graph_data.view_data.graph_id;large_width=this_graph_data.view_data.probe_list.length*350;if(large_width>10000){large_width=10000}if(large_width<small_width){large_width=small_width}$("#zoomHorizontalGraphButton").unbind();$("#zoomHorizontalGraphButton").click(function(){var a=$(graph_id).css("width");if(a==small_width+"px"){$(graph_id).css("width",large_width+"px");$("div.backgroundGraph").css("width",(large_width+110)+"px");$("#xaxis_labels"+ds_id).css("width",(large_width-110)+"px");this_graph_data.view_data.expand_horizontally=true;this_graph_data.view_data.expand_horizontally_width=large_width;selectGraphToDraw()}else{$(graph_id).css("width",small_width);$("div.backgroundGraph").css("width",(small_width+110)+"px");$("#xaxis_labels"+ds_id).css("width",(small_width-110)+"px");this_graph_data.view_data.expand_horizontally=false;selectGraphToDraw()}})}function click_no_set_min_y_axis(){$("#no_set_min_y_axis_link").unbind();$("#no_set_min_y_axis_link").click(function(){no_set_min_y_axis=this_graph_data.view_data.min_y_axis;if(no_set_min_y_axis==null){this_graph_data.view_data.min_y_axis=this_graph_data.view_data.original_min_y_axis}else{this_graph_data.view_data.min_y_axis=null}selectGraphToDraw()})}function click_normal_link(){$("a.normal_link").unbind();$("a.normal_link").click(function(){window.location=$(this).attr("href")})}function click_choose_datasets(){$("#chooseDatasets").unbind();$("#chooseDatasets").click(function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}show_all_datasets();choose_dataset_filter()})}function click_gene_info(){$("a.geneInfoButton").unbind();$("a.geneInfoButton").click(function(){$("#displayGeneDetail").modal({onShow:function(a){$("#simplemodal-container").width("auto")}})})}function click_view_genes(){$("#viewGenes").unbind();$("#viewGenes").click(function(){$("#geneSearchForm").submit()})}function click_export_functions(){$(".export_graph_data").unbind();$(".export_graph_data").click(function(){ds_id=$(this).attr("data-id");identifier="#show_graph_data"+ds_id+" table";$(identifier).table2CSV()});export_image_button_click()}function click_share_link(){var a=$("#share_link,a.share_link");a.unbind().click(function(){value=check_user_logged_in_for_sharing();if(value==false){return false}var b=$("#gene_set_id");if(b.length==0){gene_set_id=0}else{gene_set_id=b.html()}$("#wb_modal_title").html("Share this graph");var c="<form id='share_link_form'><div id=help_share_link_form>Please note that you can add more than one email address separating each with commas and no spaces. Please be aware that this does not share private objects, such as datasets or gene lists. If the email address you use doesn't have access, they will not be able to view this graph.</div><dl><dt id='to_email_label'>To Email:</dt><dd><input id='to_email_input' class='share_input' type='text' name='to_email' value=''/></dd><dt>Subject:</dt><dd><input class='share_input' type='text' name='subject' value='"+SITE_NAME+" - Expression "+$("div.title").html()+"'/></dd><dt>Body:</dt><dd><textarea class='share_input' name='body' >Here is a link I thought you might want to see:\r\n"+window.location.href+'\r\n\r\nFrom "'+$("#full_name").html()+'" '+$("#user").html()+" via "+SITE_NAME+"</textarea></dd><dt><button id='share_link_form_submit' type='button'>Submit</button></dt><dd></dd></dl><div class='clear'/><input type='hidden' name='ds_id' value="+ds_id+"><input type='hidden' name='gene_set_id' value="+gene_set_id+"></form><div class='clear'/>";$("#wb_modal_content").html(c);$("#modal_div").modal({minHeight:480,onShow:function(d){var e=this;$("#share_link_form_submit").unbind("click");$("#share_link_form_submit").click(function(g){g.preventDefault();$(this).html("Sharing...").addClass("wait");$("#simplemodal-container").addClass("wait");var f=BASE_PATH+"auth/share_gene_expression";$.post(f,$("#share_link_form").serialize(),function(h){$("#wb_modal_title").html("Share this graph");$("#wb_modal_content").html(h);$("#simplemodal-container").height("auto").removeClass("wait")})})}})})}function choose_dataset_filter(){choose_dataset=$("#choose_dataset").dataTable({bPaginate:false,bLengthChange:false,bFilter:true,bSort:true,bInfo:false,aaSorting:[[0,"asc"]],aoColumns:[null],bAutoWidth:false})}function show_all_datasets(){$(".multi_select").modal({minWidth:800,maxHeight:500})};