from pylons import request, response, session, url, tmpl_context as c
import json
import logging
log = logging.getLogger(__name__)

# Live querying
from guide.model.stemformatics import *
from guide.model.graphs import *
from pylons import config

def test():

    graph_data()

def graph():
    assert True == True 
    
def graph_data():
    ds_id = 2000
    ref_type = "ensemblID"
    ref_id = "ENSG00000149948"
    db_id = 56
    list_of_samples_to_remove = []
    this_graph_data = Graph_Data(db,ds_id,ref_type,ref_id,db_id,list_of_samples_to_remove)
    #print this_graph_data.sample_labels
    #print this_graph_data.probe_list
    assert len(this_graph_data.sample_labels) == 60
    assert this_graph_data.sample_labels == ['1979409020_C', '1979409021_F', '1979409021_G', '1979409021_B', '1979409020_F', '1979409020_G', '1979409020_H', '1979409021_C', '1979409021_D', '1979409009_A', '1979409009_B', '1979409009_C', '1979409009_D', '1979409009_E', '1979409009_F', '1979409009_G', '1979409009_H', '1979409020_B', '1699538169_A', '1699538167_A', '1699538167_B', '1699538167_C', '1699538167_D', '1699538167_E', '1699538167_F', '1699538167_G', '1699538155_A', '1699538155_B', '1699538155_E', '1787466064_A', '1787466029_C', '1699538155_D', '1787466064_F', '1699538160_C', '1787466064_H', '1699538160_E', '1787466065_B', '1699538160_G', '1699538160_H', '1787466018_A', '1787466018_B', '1787466018_C', '1787466018_D', '1787466018_E', '1787466018_F', '1787466029_E', '1787466029_G', '1787466064_C', '1699538155_G', '1699538155_H', '1787466064_E', '1787466028_G', '1787466018_H', '1699538158_A', '1699538158_B', '1699538158_C', '1787466030_C', '1699538158_E', '1699538158_F', '1699538158_G']
    assert this_graph_data.probe_list == [u'ILMN_1671547', u'ILMN_1666236']
    assert this_graph_data.probe_expression_rows == {u'ILMN_1671547': ['5.0115333377', '5.32054626981', '4.98226478968', '4.8080340015', '5.0867261073', '5.08528942812', '5.21349364406', '5.40961823165', '4.94140647681', '5.23152547546', '5.58092563909', '5.67405459306', '5.13412443456', '5.33444662793', '5.53561972612', '5.63456870115', '5.1080062474', '4.84689627139', '5.02945980572', '5.83487942284', '5.79612063244', '5.70923896401', '5.53645281247', '5.43056311827', '5.21998669052', '5.44517239085', '5.43022662085', '5.2093051849', '5.41952657747', '5.67280310491', '5.38150782717', '5.43167495202', '5.14524242336', '5.26773148667', '5.37129845116', '4.98314298774', '5.16971511466', '5.40757301622', '5.32037553097', '5.23722689243', '5.24024258358', '5.54576996945', '5.13979275601', '5.25718502539', '5.2011004465', '5.19845825222', '4.76141928859', '5.3554443728', '5.67590716447', '5.10393874673', '5.38873359501', '4.79290837701', '5.2254792155', '4.87092502369', '4.96031219781', '4.84512668349', '5.07095370615', '4.76757712734', '5.00330135448', '4.54629697882'], u'ILMN_1666236': ['5.03803120246', '5.14813132559', '3.66485262711', '3.36979495063', '4.66513905466', '3.91227687253', '4.09411746658', '3.94094254471', '3.69753202571', '4.95889536869', '3.70016551709', '4.33215014831', '4.49602958479', '4.06258191951', '4.02710320125', '4.94682757214', '4.28125595888', '3.97140618734', '3.17693476014', '3.75626111328', '3.27621391748', '3.92887403114', '4.12250411681', '3.67924857944', '4.87429589971', '3.87761393844', '4.2295655644', '3.16748967321', '3.13362156716', '3.52959652761', '3.14545470576', '2.85389406802', '3.42543319916', '3.65746222674', '4.58232272869', '4.09080814188', '3.93518396134', '4.16474423306', '4.10185368068', '3.55979888635', '3.66075264281', '3.22574231994', '3.70428041834', '3.50941733398', '3.03492963551', '2.62003235538', '2.80087132268', '3.41061930511', '3.24333027807', '3.28673221892', '4.97773092216', '3.22952101676', '3.17922945588', '3.27804677089', '3.14314147974', '3.96041435449', '3.57230051902', '3.70348189213', '4.1809195076', '3.74705945277']}
 






    list_of_samples_to_remove = ['1979409020_C','1699538158_G']
    this_graph_data.remove_samples(list_of_samples_to_remove
)
    assert len(this_graph_data.sample_labels) == 58
    assert this_graph_data.sample_labels == [ '1979409021_F', '1979409021_G', '1979409021_B', '1979409020_F', '1979409020_G', '1979409020_H', '1979409021_C', '1979409021_D', '1979409009_A', '1979409009_B', '1979409009_C', '1979409009_D', '1979409009_E', '1979409009_F', '1979409009_G', '1979409009_H', '1979409020_B', '1699538169_A', '1699538167_A', '1699538167_B', '1699538167_C', '1699538167_D', '1699538167_E', '1699538167_F', '1699538167_G', '1699538155_A', '1699538155_B', '1699538155_E', '1787466064_A', '1787466029_C', '1699538155_D', '1787466064_F', '1699538160_C', '1787466064_H', '1699538160_E', '1787466065_B', '1699538160_G', '1699538160_H', '1787466018_A', '1787466018_B', '1787466018_C', '1787466018_D', '1787466018_E', '1787466018_F', '1787466029_E', '1787466029_G', '1787466064_C', '1699538155_G', '1699538155_H', '1787466064_E', '1787466028_G', '1787466018_H', '1699538158_A', '1699538158_B', '1699538158_C', '1787466030_C', '1699538158_E', '1699538158_F']
    assert this_graph_data.probe_expression_rows == {u'ILMN_1671547': ['5.32054626981', '4.98226478968', '4.8080340015', '5.0867261073', '5.08528942812', '5.21349364406', '5.40961823165', '4.94140647681', '5.23152547546', '5.58092563909', '5.67405459306', '5.13412443456', '5.33444662793', '5.53561972612', '5.63456870115', '5.1080062474', '4.84689627139', '5.02945980572', '5.83487942284', '5.79612063244', '5.70923896401', '5.53645281247', '5.43056311827', '5.21998669052', '5.44517239085', '5.43022662085', '5.2093051849', '5.41952657747', '5.67280310491', '5.38150782717', '5.43167495202', '5.14524242336', '5.26773148667', '5.37129845116', '4.98314298774', '5.16971511466', '5.40757301622', '5.32037553097', '5.23722689243', '5.24024258358', '5.54576996945', '5.13979275601', '5.25718502539', '5.2011004465', '5.19845825222', '4.76141928859', '5.3554443728', '5.67590716447', '5.10393874673', '5.38873359501', '4.79290837701', '5.2254792155', '4.87092502369', '4.96031219781', '4.84512668349', '5.07095370615', '4.76757712734', '5.00330135448'], u'ILMN_1666236': ['5.14813132559', '3.66485262711', '3.36979495063', '4.66513905466', '3.91227687253', '4.09411746658', '3.94094254471', '3.69753202571', '4.95889536869', '3.70016551709', '4.33215014831', '4.49602958479', '4.06258191951', '4.02710320125', '4.94682757214', '4.28125595888', '3.97140618734', '3.17693476014', '3.75626111328', '3.27621391748', '3.92887403114', '4.12250411681', '3.67924857944', '4.87429589971', '3.87761393844', '4.2295655644', '3.16748967321', '3.13362156716', '3.52959652761', '3.14545470576', '2.85389406802', '3.42543319916', '3.65746222674', '4.58232272869', '4.09080814188', '3.93518396134', '4.16474423306', '4.10185368068', '3.55979888635', '3.66075264281', '3.22574231994', '3.70428041834', '3.50941733398', '3.03492963551', '2.62003235538', '2.80087132268', '3.41061930511', '3.24333027807', '3.28673221892', '4.97773092216', '3.22952101676', '3.17922945588', '3.27804677089', '3.14314147974', '3.96041435449', '3.57230051902', '3.70348189213', '4.1809195076']}
    #this_Graph = Graph(this_graph_data)

    assert this_graph_data.probe_information == {u'ILMN_1671547': 2, u'ILMN_1666236': 1}

    assert this_graph_data.y_axis_label == "Log2 Expression"
    assert this_graph_data.min_y_axis == 0.0
    assert this_graph_data.handle == "Matigian_2009_20699480"
    assert this_graph_data.ds_md == {u'detectionThreshold': u'5.00', u'Title': u'Disease-specific, neurosphere-derived cells as models for brain disorders', u's4mCurator': u'O.Korn,A.Miotto', u'Experimental Design': u'transcription profiling by array', u'Platform': u'Illumina HumanRef-8 v2', u'cellularProteinExpression': u'', u'Contributor Name': u'Nicholas Matigian', u'Description': u"Understanding the molecular bases of neurological and psychiatric conditions is hampered by a lack of suitable patient-derived cellular models. The olfactory mucosa is a continually regenerating neural tissue that contains multipotent neural stem cells which are accessible and expandable in vitro as neurospheres. Here we demonstrate disease-specific differences in neurosphere-derived cell lines from patients with two unrelated neurological conditions. Lines derived from donors with schizophrenia exhibited significant dysregulation of neurodevelopmental pathways whereas those obtained from donors with Parkinson's disease demonstrated significant dysgregulation in mitochondrial function, oxidative stress and xenobiotic metabolism. Our model supports the hypothesis that diseases with multiple genetic and environmental risk factors are revealed in convergent cellular and molecular pathways in olfactory neurosphere-derived cells taken from patient cohorts. These patient-derived cells provide informative models that provide insights into neurobiological correlates of neurological and psychiatric disorders that may be useful for many neuropsychiatric/neurodegenerative conditions and for drug discovery", u'nucleicAcidExtract': u'total RNA extract', u'PubMed ID': u'20699480', u'sampleTypeDisplayOrder': u'hONS,fibroblast', u'Authors': u'Nicholas Matigian, Greger Abrahamsen, Ratneswary Sutharsan, Anthony L Cook, Amanda Nouwens, Bernadette Bellette, Alejandra M Vitale, Jiyuan An, Matthew Anderson, Anthony Beckhouse, Maikel Bennebroek, Rowena Cecil, Alistair M Chalk, Julie Cochrane, Youngjun Fan, Francois Feron, Richard McCurdy, John McGrath, W. Murrell, Chris Perry, Jothy Raju, Sugandha Ravishankar, Peter Silburn, Greg Sutherland, Stephen Mahler, George Mellick, Stephen A Wood, Carolyn Sue, Christine Wells, Alan Mackay-Sim', u'sampleTypeDisplayGroups': u'{"hONS":0,"fibroblast":1}', u'Assay Version': u'V2', u'Release Date': u'2009-12-01', u'AE Accession': u'E-TABM-724', u'technologyUsed': u'microarray', u'probesDetected': u'12100', u'Contributor Email': u'n.matigian@griffith.edu.au', u'Assay Platform': u'HumanRef-8', u'maxReplicates': u'2', u'Contact Name': u'Alan Mackay-Sim', u'cellsSamplesAssayed': u'human olfactory neurosphere (hONS),fibroblast', u's4mCurationDate': u'2010-12-02', u'topDifferentiallyExpressedGenes': u'ENSG00000170962,ENSG00000101825,ENSG00000077943,ENSG00000243137,ENSG00000136928', u'Organism': u'Homo sapiens', u'minReplicates': u'1', u'probeCount': u'22184', u'Publication Title': u'Disease-specific, neurosphere-derived cells as models for brain disorders', u'medianDatasetExpression': u'8.93', u'Accession': u'E-TABM-724', u'Publication Citation': u'Dis Model Mech. 2010 Nov-Dec;3(11-12):785-98. Epub 2010 Aug 10', u'Affiliation': u'National Centre for Adult Stem Cell Research, Griffith University', u'Assay Manufacturer': u'Illumina', u'Contact Email': u'a.mackay-sim@griffith.edu.au', u'limitSortBy': u'Sample Type,Disease State', u'cellSurfaceAntigenExpression': u''}

    sortBy = "Sample Type" 
    this_graph = Scatterplot_Graph(this_graph_data,sortBy) 
    assert this_graph.graph_data.y_axis_label == "Log2 Expression"

    assert this_graph.grouped_graph_data['ILMN_1671547'] == {'fibroblast': {'raw_values': [5.32054626981, 4.98226478968, 4.8080340015, 5.0867261073, 5.08528942812, 5.21349364406, 5.40961823165, 4.94140647681, 5.23152547546, 5.58092563909, 5.67405459306, 5.13412443456, 5.33444662793, 5.53561972612, 5.63456870115, 5.1080062474, 4.84689627139], 'points': {u'fibroblast_100020002': {'standard_deviation': 0.693831370017, 'chip_type': 21, 'expression_value': 5.32054626981, 'sample_size': 1}, u'fibroblast_100020003': {'standard_deviation': 0.366566999174, 'chip_type': 21, 'expression_value': 4.98226478968, 'sample_size': 1}, u'fibroblast_300020002': {'standard_deviation': 0.543883781062, 'chip_type': 21, 'expression_value': 5.58092563909, 'sample_size': 1}, u'fibroblast_300020003': {'standard_deviation': 0.478240763905, 'chip_type': 21, 'expression_value': 5.67405459306, 'sample_size': 1}, u'fibroblast_300020004': {'standard_deviation': 1.30881092971, 'chip_type': 21, 'expression_value': 5.13412443456, 'sample_size': 1}, u'fibroblast_300020005': {'standard_deviation': 0.566424430341, 'chip_type': 21, 'expression_value': 5.33444662793, 'sample_size': 1}, u'fibroblast_300020006': {'standard_deviation': 1.9708626099, 'chip_type': 21, 'expression_value': 5.53561972612, 'sample_size': 1}, u'fibroblast_300020001': {'standard_deviation': 0.360235394175, 'chip_type': 21, 'expression_value': 5.23152547546, 'sample_size': 1}, u'fibroblast_300020008': {'standard_deviation': 0.310189665184, 'chip_type': 21, 'expression_value': 5.1080062474, 'sample_size': 1}, u'fibroblast_300020009': {'standard_deviation': 0.130180235426, 'chip_type': 21, 'expression_value': 4.84689627139, 'sample_size': 1}, u'fibroblast_300020007': {'standard_deviation': 0.581396784105, 'chip_type': 21, 'expression_value': 5.63456870115, 'sample_size': 1}, u'fibroblast_100030003': {'standard_deviation': 0.0715834628557, 'chip_type': 21, 'expression_value': 5.0867261073, 'sample_size': 1}, u'fibroblast_100030001': {'standard_deviation': 0.0976354439298, 'chip_type': 21, 'expression_value': 4.8080340015, 'sample_size': 1}, u'fibroblast_100030007': {'standard_deviation': 0.961797574983, 'chip_type': 21, 'expression_value': 4.94140647681, 'sample_size': 1}, u'fibroblast_100030006': {'standard_deviation': 0.0578467073495, 'chip_type': 21, 'expression_value': 5.40961823165, 'sample_size': 1}, u'fibroblast_100030005': {'standard_deviation': 0.139424462818, 'chip_type': 21, 'expression_value': 5.21349364406, 'sample_size': 1}, u'fibroblast_100030004': {'standard_deviation': 0.0149382202985, 'chip_type': 21, 'expression_value': 5.08528942812, 'sample_size': 1}}, 'statistics': {'Q1': 5.0852894281200003, 'Q3': 5.4096182316499997, 'Q2': 5.2134936440599997, 'Min': 4.8080340015000003, 'Max': 5.6740545930600002, 'Average': 5.2310321567700004, 'Median': 5.2134936440599997, 'StandardDeviation': 0.26167621791488405}}, 'hONS': {'raw_values': [5.02945980572, 5.83487942284, 5.79612063244, 5.70923896401, 5.53645281247, 5.43056311827, 5.21998669052, 5.44517239085, 5.43022662085, 5.2093051849, 5.41952657747, 5.67280310491, 5.38150782717, 5.43167495202, 5.14524242336, 5.26773148667, 5.37129845116, 4.98314298774, 5.16971511466, 5.40757301622, 5.32037553097, 5.23722689243, 5.24024258358, 5.54576996945, 5.13979275601, 5.25718502539, 5.2011004465, 5.19845825222, 4.76141928859, 5.3554443728, 5.67590716447, 5.10393874673, 5.38873359501, 4.79290837701, 5.2254792155, 4.87092502369, 4.96031219781, 4.84512668349, 5.07095370615, 4.76757712734, 5.00330135448], 'points': {u'hONS_200060001': {'standard_deviation': 0.27123859195, 'chip_type': 21, 'expression_value': 5.24024258358, 'sample_size': 1}, u'hONS_200060003': {'standard_deviation': 0.256042502425, 'chip_type': 21, 'expression_value': 5.54576996945, 'sample_size': 1}, u'hONS_200060005': {'standard_deviation': 0.328956169032, 'chip_type': 21, 'expression_value': 5.13979275601, 'sample_size': 1}, u'hONS_200060007': {'standard_deviation': 0.11779191773, 'chip_type': 21, 'expression_value': 5.2011004465, 'sample_size': 1}, u'hONS_200060006': {'standard_deviation': 0.66857904831, 'chip_type': 21, 'expression_value': 5.25718502539, 'sample_size': 1}, u'hONS_200070001': {'standard_deviation': 0.339339078156, 'chip_type': 21, 'expression_value': 5.19845825222, 'sample_size': 1}, u'hONS_200550006': {'standard_deviation': 0.979632788559, 'chip_type': 21, 'expression_value': 5.38873359501, 'sample_size': 1}, u'hONS_100550001': {'standard_deviation': 0.0105770051662, 'chip_type': 21, 'expression_value': 5.43167495202, 'sample_size': 1}, u'hONS_200070002': {'standard_deviation': 0.0, 'chip_type': 21, 'expression_value': 4.76141928859, 'sample_size': 1}, u'hONS_100030007': {'standard_deviation': 0.690491523493, 'chip_type': 21, 'expression_value': 5.2093051849, 'sample_size': 1}, u'hONS_100030006': {'standard_deviation': 0.0417874870185, 'chip_type': 21, 'expression_value': 5.43022662085, 'sample_size': 1}, u'hONS_100030005': {'standard_deviation': 0.0598643901039, 'chip_type': 21, 'expression_value': 5.44517239085, 'sample_size': 1}, u'hONS_100030004': {'standard_deviation': 0.270535085986, 'chip_type': 21, 'expression_value': 5.21998669052, 'sample_size': 1}, u'hONS_100030003': {'standard_deviation': 0.0467528368242, 'chip_type': 21, 'expression_value': 5.43056311827, 'sample_size': 1}, u'hONS_200030001': {'standard_deviation': 0.524761642284, 'chip_type': 21, 'expression_value': 5.14524242336, 'sample_size': 1}, u'hONS_200030002': {'standard_deviation': 0.0889293314519, 'chip_type': 21, 'expression_value': 5.26773148667, 'sample_size': 1}, u'hONS_200550002': {'standard_deviation': 0.117327177323, 'chip_type': 21, 'expression_value': 5.3554443728, 'sample_size': 1}, u'hONS_200550005': {'standard_deviation': 0.246245620556, 'chip_type': 21, 'expression_value': 5.10393874673, 'sample_size': 1}, u'hONS_200550004': {'standard_deviation': 0.228591421318, 'chip_type': 21, 'expression_value': 5.67590716447, 'sample_size': 1}, u'hONS_100030009': {'standard_deviation': 0.0936167698553, 'chip_type': 21, 'expression_value': 5.67280310491, 'sample_size': 1}, u'hONS_100030002': {'standard_deviation': 0.208627264803, 'chip_type': 21, 'expression_value': 5.53645281247, 'sample_size': 1}, u'hONS_100030001': {'standard_deviation': 0.329461487409, 'chip_type': 21, 'expression_value': 5.70923896401, 'sample_size': 1}, u'hONS_200050002': {'standard_deviation': 0.459448488954, 'chip_type': 21, 'expression_value': 4.98314298774, 'sample_size': 1}, u'hONS_200050003': {'standard_deviation': 0.69607664941, 'chip_type': 21, 'expression_value': 5.16971511466, 'sample_size': 1}, u'hONS_100070001': {'standard_deviation': 0.215088975575, 'chip_type': 21, 'expression_value': 5.38150782717, 'sample_size': 1}, u'hONS_200050001': {'standard_deviation': 0.52237787719, 'chip_type': 21, 'expression_value': 5.37129845116, 'sample_size': 1}, u'hONS_200050006': {'standard_deviation': 0.631189645275, 'chip_type': 21, 'expression_value': 5.23722689243, 'sample_size': 1}, u'hONS_200050004': {'standard_deviation': 0.0961649803954, 'chip_type': 21, 'expression_value': 5.40757301622, 'sample_size': 1}, u'hONS_200050005': {'standard_deviation': 0.599703106725, 'chip_type': 21, 'expression_value': 5.32037553097, 'sample_size': 1}, u'hONS_300020001': {'standard_deviation': 0.353287328355, 'chip_type': 21, 'expression_value': 4.79290837701, 'sample_size': 1}, u'hONS_300020004': {'standard_deviation': 0.276192478258, 'chip_type': 21, 'expression_value': 4.96031219781, 'sample_size': 1}, u'hONS_300020005': {'standard_deviation': 0.0534342082428, 'chip_type': 21, 'expression_value': 4.84512668349, 'sample_size': 1}, u'hONS_300020006': {'standard_deviation': 0.611646376837, 'chip_type': 21, 'expression_value': 5.07095370615, 'sample_size': 1}, u'hONS_300020007': {'standard_deviation': 1.21905220033, 'chip_type': 21, 'expression_value': 4.76757712734, 'sample_size': 1}, u'hONS_100020002': {'standard_deviation': 0.636430610779, 'chip_type': 21, 'expression_value': 5.83487942284, 'sample_size': 1}, u'hONS_100020003': {'standard_deviation': 0.106838117685, 'chip_type': 21, 'expression_value': 5.79612063244, 'sample_size': 1}, u'hONS_300020002': {'standard_deviation': 0.702926291623, 'chip_type': 21, 'expression_value': 5.2254792155, 'sample_size': 1}, u'hONS_100020001': {'standard_deviation': 0.0469961765121, 'chip_type': 21, 'expression_value': 5.02945980572, 'sample_size': 1}, u'hONS_300020003': {'standard_deviation': 0.140650132232, 'chip_type': 21, 'expression_value': 4.87092502369, 'sample_size': 1}, u'hONS_300020008': {'standard_deviation': 0.799316507466, 'chip_type': 21, 'expression_value': 5.00330135448, 'sample_size': 1}, u'hONS_100030008': {'standard_deviation': 0.285807833177, 'chip_type': 21, 'expression_value': 5.41952657747, 'sample_size': 1}}, 'statistics': {'Q1': 5.1039387467299999, 'Q3': 5.4302266208500001, 'Q2': 5.2402425835799997, 'Min': 4.76141928859, 'Max': 5.8348794228400003, 'Average': 5.2647268266797553, 'Median': 5.2402425835799997, 'StandardDeviation': 0.26930464217109756}}}

    assert len(this_graph.plot_data['ILMN_1671547']) == 58

    this_view = View(this_graph)
    assert len(this_view.graph.plot_data['ILMN_1671547']) == 58
    json_data = this_view.get_json_data()
    assert json_data == ""
    pass
     
